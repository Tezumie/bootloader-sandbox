/*
  ; -------------------------------------
  ; ON-CHAIN METADATA
  ; -------------------------------------

  bootloader:

      db "generative"
      db "self-portrait"
      db "fully on-chain"
      db "poster"

      EQU EDITION_COUNT, 1000
*/

const{svg:t,rnd:e,seed:n,iterationNumber:i,isPreview:l}=BTLDR,W=800,H=1200;t.setAttribute("viewBox","0 0 800 1200"),t.setAttribute("preserveAspectRatio","xMidYMid meet");const NS="http://www.w3.org/2000/svg",R=()=>e(),ir=(t,e)=>Math.floor(t+R()*(e-t+1)),fr=(t,e)=>t+R()*(e-t),el=(t,e={},n=[])=>{let i=document.createElementNS(NS,t);for(let l in e)i.setAttribute(l,String(e[l]));return n.forEach(t=>i.appendChild(t)),i},article=t=>/^[aeiou]/i.test(t)?"an":"a",HEAD="Helvetica",BODY="ui-monospace, SFMono-Regular, Menlo, Consolas, monospace",CAP_FS=25,CAP_LH=32,CAP_WEIGHT=1e3,JUSTIFY_LAST_LINE=!1;if(l){t.setAttribute("viewBox","0 0 800 800"),t.setAttribute("preserveAspectRatio","xMidYMid meet");t.appendChild(el("rect",{x:0,y:0,width:800,height:800,fill:"#000"}));let a=el("text",{"font-size":10,"font-family":HEAD,"font-weight":900,visibility:"hidden","xml:space":"preserve"});t.appendChild(a);let o=(t,e)=>(a.setAttribute("font-size",e),a.textContent=t,a.getBBox().width||0),r=Math.floor(176);for(;o("bootloader:",r)>688&&r>12;)r-=2;t.appendChild(el("text",{x:400,y:400,"font-size":r,"font-family":HEAD,"font-weight":900,fill:"#fff","text-anchor":"middle","dominant-baseline":"middle","xml:space":"preserve"})).textContent="bootloader:",t.appendChild(el("desc")).textContent="bootloader: preview — square viewBox, cream background, black title"}else{let s=[{name:"PorcelainOnCarbon",bg:"#101214",fg:"#f5f7fa",w:26},{name:"InkOnIvory",bg:"#fffaf0",fg:"#0b0b0b",w:26},{name:"MidnightCyan",bg:"#0b0e14",fg:"#00e5ff",w:10},{name:"WineMagenta",bg:"#120714",fg:"#ff2ac9",w:7},{name:"ForestTeal",bg:"#06110e",fg:"#1ee6a8",w:5},{name:"UmberAmber",bg:"#201508",fg:"#ffbf2a",w:3},],$=s.reduce((t,e)=>t+e.w,0),h=R()*$,d=s[0];for(let f of s)if((h-=f.w)<=0){d=f;break}t.appendChild(el("rect",{x:0,y:0,width:800,height:1200,fill:d.bg}));t.appendChild(el("text",{x:72,y:72,"font-size":112,"font-family":HEAD,"font-weight":900,fill:d.fg,"dominant-baseline":"hanging"})).textContent="bootloader:";let p=(t,e=25)=>t.length*(.6*e),_=(t,e,n,i,l,a=25,o=32,r=1e3)=>{let s=el("text",{x:e,y:n,"font-size":a,"font-family":BODY,"font-weight":r,fill:d.fg,"text-anchor":"start","dominant-baseline":"hanging","xml:space":"preserve"});t.appendChild(s);let $=i.trim().split(/\s+/),h=[],f="";for(let _=0;_<$.length;_++){let m=f?f+" "+$[_]:$[_];p(m,a)<=l?f=m:f?(h.push(f),f=$[_]):(h.push($[_]),f="")}f&&h.push(f);let g=0;for(let u=0;u<h.length;u++){let c=el("tspan",{x:e,y:n+g});c.textContent=h[u],u<h.length-1&&(c.setAttribute("textLength",String(l)),c.setAttribute("lengthAdjust","spacing")),s.appendChild(c),g+=o}return{node:s,bottom:n+h.length*o,height:h.length*o,lines:h.length}},m=(t,e,n,i,l,a=12,o=10,r="start")=>{let s=a,$=p(i,s);for(;$>l&&s>o;)s-=1,$=p(i,s);let h=el("text",{x:e,y:n,"font-size":s,"font-family":BODY,"font-weight":1e3,fill:d.fg,"text-anchor":r,"dominant-baseline":"alphabetic","xml:space":"preserve"});return h.textContent=i,t.appendChild(h),{x:e,y:n-s,width:$,height:s}},g=t=>{try{let e="bigint"==typeof t?t.toString(16):String(t);return(e=e.replace(/^0x/i,"").toLowerCase()).length<64&&(e="0".repeat(64-e.length)+e),e.length%2&&(e="0"+e),"0x"+e}catch{return"0x"+"0".repeat(64)}},u=g(n),c="bigint"==typeof n?0n!==n:"0"!==String(n),w=c&&.45>R(),x=.018>R(),b=.28>R(),y=.005>R()?0:.6>R()?1:2,C=(t,e,n,i,l=-Math.PI/2)=>{let a="";for(let o=0;o<i;o++){let r=l+o*(2*Math.PI/i),s=t+n*Math.cos(r),$=e+n*Math.sin(r);a+=o?` L ${s} ${$}`:`M ${s} ${$}`}return a+" Z"},k=[{k:"circle",w:10,draw:(t,e,n,i,l)=>"outline"===l?el("circle",{cx:t,cy:e,r:n,fill:"none",stroke:i,"stroke-width":Math.max(50,Math.round(.22*n))}):el("circle",{cx:t,cy:e,r:n,fill:i}),anim:"spin"},{k:"square",w:10,draw(t,e,n,i,l){let a=n/Math.SQRT2;return"outline"===l?el("rect",{x:t-a,y:e-a,width:2*a,height:2*a,fill:"none",stroke:i,"stroke-width":Math.max(50,Math.round(.22*n))}):el("rect",{x:t-a,y:e-a,width:2*a,height:2*a,fill:i})},anim:"tilt"},{k:"triangle",w:10,draw(t,e,n,i,l){let a=`M ${t} ${e-n} L ${t-.866*n} ${e+.5*n} L ${t+.866*n} ${e+.5*n} Z`;return"outline"===l?el("path",{d:a,fill:"none",stroke:i,"stroke-width":Math.max(50,Math.round(.18*n))}):el("path",{d:a,fill:i})},anim:"spin"},{k:"pentagon",w:5,draw(t,e,n,i,l){let a=C(t,e,n,5);return"outline"===l?el("path",{d:a,fill:"none",stroke:i,"stroke-width":Math.max(50,Math.round(.18*n))}):el("path",{d:a,fill:i})},anim:"spin"},{k:"hexagon",w:3,draw(t,e,n,i,l){let a=C(t,e,n,6);return"outline"===l?el("path",{d:a,fill:"none",stroke:i,"stroke-width":Math.max(50,Math.round(.18*n))}):el("path",{d:a,fill:i})},anim:"spin"},],A=k.reduce((t,e)=>t+(e.w??10),0),v=()=>{let t=R()*A;for(let e of k)if((t-=e.w??10)<=0)return e;return k[0]},z=()=>.2>R()?"slow":.9>R()?"normal":.99>R()?"fast":"ultra",B=(t,e)=>{let n={spin:"spins",tilt:"tilts",breath:"breathes"}[t]||"pulses",i="slow"===e?" slowly":"fast"===e?" fast":"ultra"===e?" ultra fast":"";return n+i},M=(t,e)=>{let n={spin:{slow:14,normal:24,fast:48,ultra:150},tilt:{slow:.9,normal:1.4,fast:2.4,ultra:4.8},breath:{slow:1.2,normal:2,fast:3.2,ultra:5.8},pulse:{slow:1.2,normal:2.2,fast:3.4,ultra:6}};return(n[t]||n.pulse)[e]},S=t=>{let e="outline"===t.style?Math.max(8,Math.round(.14*t.sz)):0;return t.sz+e/2},D=t=>{let e=S(t);return e<160?"small":e>224.00000000000003?"big":"medium"},E=t=>`${article(D(t))} ${D(t)} ${"outline"===t.style?"outlined":"solid"} ${t.sh.k}`,I=(t,e)=>{let n=S(t),i=S(e);return n>1.08*i?"larger":n<.92*i?"smaller":"similar in size"},L=fr(144,208),P=[];for(let O=0;O<y;O++){let Y=v(),T=.35>R()?"outline":"solid";P.push({sh:Y,sz:L*fr(.8,1.1),style:T,opacity:1,tp:z()})}let j=()=>{if(0===y)return"showing nothing";if(1===y){let t=P[0];return`showing ${E(t)} that ${B(t.sh.anim,t.tp)}`}let[e,n]=P,i=e.sh.k===n.sh.k,l=e.style===n.style,a=B(e.sh.anim,e.tp)===B(n.sh.anim,n.tp);if(i&&l&&a){let o=I(n,e);return"similar in size"===o?`showing ${E(e)} that ${B(e.sh.anim,e.tp)} and another`:`showing ${E(e)} that ${B(e.sh.anim,e.tp)} and another, ${o} one`}return i&&l?`showing ${E(e)} that ${B(e.sh.anim,e.tp)} and another one that ${B(n.sh.anim,n.tp)}`:i?`showing ${E(e)} that ${B(e.sh.anim,e.tp)} and another ${"outline"===n.style?"outlined":"solid"} one that ${B(n.sh.anim,n.tp)}`:`showing ${E(e)} that ${B(e.sh.anim,e.tp)} and ${E(n)} that ${B(n.sh.anim,n.tp)}`},F=()=>0===y?"only the caption is rendered":1===y?x?"it sits in front of the caption":"it sits below the caption":x?"they sit in front of the caption":"they sit below the caption",N=["This poster is code rendered as SVG","assembled on-chain and executed in your browser",c&&w?"with the seed visible":null,j(),"in two colors",].filter(Boolean),q=N.join(", ")+"; "+F()+".",G=el("g");t.appendChild(G);let U=656,V=192,Z=_(G,72,192,q,656,25,32,400).bottom,J=1178,Q="1";try{if("bigint"==typeof i)Q=i.toString();else{let K=Number(i);Number.isFinite(K)&&K>0&&(Q=String(K))}}catch{}let X=`${Q} / 1000`,tt=el("text",{x:728,y:1178,"font-size":13,"font-family":BODY,"font-weight":1e3,fill:d.fg,"text-anchor":"end","dominant-baseline":"alphabetic","xml:space":"preserve"});tt.textContent=X,t.appendChild(tt);let te=p(X,13),tn={x:728-te,y:1165,width:te,height:13},ti=tn.y;if(c&&w){let tl=el("g");t.appendChild(tl);let ta=Math.max(140,tn.width+24),to=Math.max(60,656-ta),tr=m(tl,72,1178,`seed: ${u}`,to,12,10,"start");ti=Math.min(ti,tr.y)}let ts=Z+36,t$=ti-10,th=132,td=668,tf=x?184:Math.max(ts,204),tp=Math.max(tf+50,t$),t_=[];for(let tm=0;tm<P.length;tm++){let tg=P[tm],tu=S(tg),tc,tw,t0=!1,tx=0;if(2===P.length&&b&&1===tm&&!x){let tb=t_[0],ty=tu+tb.rad;for(;!t0&&tx<80;){tx++;let t9=fr(0,2*Math.PI),tC=fr(.55*ty,.95*ty);tc=tb.cx+Math.cos(t9)*tC,tw=tb.cy+Math.sin(t9)*tC,!(tc-tu<132)&&!(tc+tu>668)&&!(tw-tu<tf)&&!(tw+tu>tp)&&(t0=!0)}}for(;!t0&&tx<160;){if(tx++,tc=fr(132,668),tw=fr(tf,tp),!b&&t_.length&&!x){let t4=t_[0];if(Math.hypot(t4.cx-tc,t4.cy-tw)<=(t4.rad+tu)*.98)continue}!(tc-tu<132)&&!(tc+tu>668)&&!(tw-tu<tf)&&!(tw+tu>tp)&&(t0=!0)}t_.push({...tg,cx:tc,cy:tw,rad:tu})}if(2===t_.length){let[t6,t3]=t_,tk=Math.hypot(t6.cx-t3.cx,t6.cy-t3.cy),t2=tk<(t6.rad+t3.rad)*.98?"they intersect":"they keep their distance";G.textContent="";let tA=`${t2}, and ${x?"they sit in front of the caption":"they sit below the caption"}.`;_(G,72,192,q=N.join(", ")+"; "+tA,656,25,32,400)}let t1=null;if(!x){t1="clipBand";let tR=el("defs"),tv=el("clipPath",{id:t1});tv.appendChild(el("rect",{x:0,y:ts,width:800,height:Math.max(0,tp-ts)})),tR.appendChild(tv),t.appendChild(tR)}let t7=el("g",t1?{"clip-path":`url(#${t1})`}:{});t.appendChild(t7);let t5=[];for(let tz of t_){let tB=el("g"),tM=tz.sh.draw(tz.cx,tz.cy,tz.sz,d.fg,tz.style);tB.appendChild(tM),t7.appendChild(tB),t5.push({node:tB,info:tz})}x&&t.appendChild(t7),(()=>{let t=performance.now(),e=()=>{let n=(performance.now()-t)/1e3;for(let{node:i,info:l}of t5){let{cx:a,cy:o,sz:r}=l,s=l.sh.anim,$=M(s,l.tp);if("spin"===s)i.setAttribute("transform",`rotate(${n*$%360} ${a} ${o})`);else if("tilt"===s)i.setAttribute("transform",`rotate(${35*Math.sin(n*$)} ${a} ${o})`);else if("breath"===s){let h=Math.max(8,Math.round(.16*r));i.firstChild.setAttribute("stroke-width",Math.round(h*(1+.18*Math.sin(n*$))))}else{let d=1+.06*Math.sin(n*$);i.setAttribute("transform",`translate(${a*(1-d)} ${o*(1-d)}) scale(${d})`)}}requestAnimationFrame(e)};requestAnimationFrame(e)})();let tS={project:"bootloader: self-portrait",seed_hex:u,traits:{palette:d.name,shapeCount:t_.length,shapes:t_.map(t=>t.sh.k),styles:t_.map(t=>t.style),tempos:t_.map(t=>t.tp),frontOfCaption:x,seedVisible:w,edition:X}};t.appendChild(el("metadata")).textContent=JSON.stringify(tS),t.appendChild(el("desc")).textContent=`poster • ${d.name} • shapes:${t_.map(t=>t.sh.k).join(", ")} • seed:${c&&w?u:"hidden"} • edition:${X}`}